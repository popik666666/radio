<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Popik666 R√°dio</title>
  <style>
    body{background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif;margin:0;padding:18px;text-align:center}
    h1{margin:6px 0}
    .banner{width:100%;max-width:600px;margin:10px auto;display:block;border-radius:8px}
    #adminKey{position:fixed;top:10px;right:10px;font-size:24px;cursor:pointer;background:#222;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 5px #000}
    #adminLoginBox{position:fixed;top:50px;right:10px;background:#222;padding:8px;border-radius:8px;box-shadow:0 0 5px #000;display:none;width:170px;text-align:center;font-size:14px}
    input,button,textarea{padding:7px;margin:4px;border:none;border-radius:6px}
    button{background:#0a84ff;color:#fff;cursor:pointer}
    .login-box,.content-box,.admin-panel{background:#222;padding:14px;border-radius:8px;box-shadow:0 0 6px #000;margin-top:10px;text-align:center}
    #infoPanel{background:#333;padding:8px;border-radius:6px;min-height:44px;font-size:14px}
    textarea{width:95%;height:70px;resize:none;font-size:14px}
    audio{width:100%;max-width:560px;margin-top:8px}
    #playOverlay{display:none;margin:14px auto}
    #smallNote{font-size:12px;color:#bbb;margin-top:6px}
  </style>
</head>
<body>
  <img src="/attachments/Lbc8ffND117U4Gc1EuYrB.jpeg" alt="banner" class="banner" />
  <h1>üéß Popik666 R√°dio</h1>

  <!-- admin key -->
  <div id="adminKey" onclick="toggleAdminLogin()">üîë</div>

  <!-- admin login box -->
  <div id="adminLoginBox">
    <input id="adminPassword" type="password" placeholder="Admin k√≥d" /><br/>
    <button onclick="adminLogin()">OK</button>
    <p id="adminMsg" style="font-size:12px;margin:6px 0"></p>
  </div>

  <!-- listener login -->
  <div id="login" class="login-box">
    <h3>P≈ôihl√°≈°en√≠ posluchaƒçe</h3>
    <input id="listenerPassword" type="password" placeholder="K√≥d" /><br/>
    <button onclick="listenerLogin()">P≈ôihl√°sit</button>
    <p id="listenerMsg" style="font-size:12px;margin:6px 0"></p>
  </div>

  <!-- content for listeners -->
  <div id="content" class="content-box" style="display:none">
    <h2>V√≠tej v Popik r√°diu üé∂</h2>

    <!-- audio player -->
    <audio id="player" controls preload="auto" crossorigin="anonymous">
      <source id="playerSource" src="http://s38.myradiostream.com:16686/" type="audio/mpeg" />
      V√°≈° prohl√≠≈æeƒç nepodporuje audio tag.
    </audio>

    <!-- big play button shown if autoplay blocked -->
    <div id="playOverlay">
      <button id="bigPlayBtn" style="font-size:18px;padding:12px 20px">‚ñ∂Ô∏è Spustit r√°dio</button>
      <div id="smallNote">Pokud se r√°dio nespustilo automaticky, stisknƒõte Play.</div>
    </div>

    <h3>‚ÑπÔ∏è Informaƒçn√≠ panel:</h3>
    <div id="infoPanel"><p>V√≠tejte! Poslouchejte ≈æiv√© vys√≠l√°n√≠.</p></div>

    <h3 style="margin-top:10px">üìª Alternativn√≠ p≈ôehr√°vaƒç:</h3>
    <script src="//myradiostream.com/embed/Popik666"></script>
  </div>

  <!-- admin panel -->
  <div id="adminPanel" class="admin-panel" style="display:none">
    <h3>‚öôÔ∏è Admin</h3>
    <button onclick="logoutAdmin()" style="font-size:12px">Odhl√°sit</button>
    <p>Aktu√°ln√≠ k√≥d: <span id="currentCode"></span></p>
    <input id="newCode" type="text" placeholder="Nov√Ω k√≥d" /><button onclick="changeCode()">Zmƒõnit</button>
    <p id="codeMsg" style="font-size:12px;margin:6px 0"></p>

    <h3>üìù Info panel:</h3>
    <textarea id="adminMessage" placeholder="Zpr√°va pro posluchaƒçe..."></textarea><br/>
    <button onclick="updateInfo()" style="font-size:12px">Aktualizovat</button>
    <button onclick="deleteInfo()" style="font-size:12px">Smazat</button>
    <p id="infoMsg" style="font-size:12px;margin:6px 0"></p>
  </div>

  <img src="/attachments/zjqnSnUg4ynx6C2c7rLAZ.jpeg" alt="skull" class="banner" />

<script>
const STREAM_URL = "http://s38.myradiostream.com:16686/";
const ADMIN_PASS = "p666pr";
let listenerCode = localStorage.getItem('listenerCode') || '321456';
document.getElementById('currentCode').textContent = listenerCode;
let infoText = localStorage.getItem('infoText') || 'V√≠tejte! Poslouchejte ≈æiv√© vys√≠l√°n√≠.';
document.getElementById('infoPanel').innerHTML = '<p>'+infoText+'</p>';

const player = document.getElementById('player');
const playOverlay = document.getElementById('playOverlay');
const bigPlayBtn = document.getElementById('bigPlayBtn');

function setStreamSrc() {
  const source = player.querySelector('source');
  source.src = STREAM_URL;
  player.load();
}

function tryAutoplay() {
  player.play().then(() => {
    playOverlay.style.display = 'none';
  }).catch(() => {
    playOverlay.style.display = 'block';
  });
}

bigPlayBtn.addEventListener('click', () => {
  player.play().then(() => {
    playOverlay.style.display = 'none';
  }).catch(() => {
    alert('Nepoda≈ôilo se spustit p≈ôehr√°vaƒç ‚Äî zkus aktualizovat str√°nku.');
  });
});

let reconnectInterval = null;
function startReconnectLoop() {
  if (reconnectInterval) return;
  reconnectInterval = setInterval(() => {
    if (player.paused || player.networkState === 3) {
      setStreamSrc();
      player.play().catch(() => {});
    }
  }, 5000);
}

function stopReconnectLoop() {
  if (reconnectInterval) {
    clearInterval(reconnectInterval);
    reconnectInterval = null;
  }
}

player.addEventListener('error', () => {
  playOverlay.style.display = 'block';
  startReconnectLoop();
});

player.addEventListener('stalled', () => {
  playOverlay.style.display = 'block';
  startReconnectLoop();
});

player.addEventListener('playing', () => {
  playOverlay.style.display = 'none';
  stopReconnectLoop();
});

player.addEventListener('pause', () => {
  // Pokud u≈æivatel s√°m pozastavil, nic se nedƒõl√°
});

function toggleAdminLogin() {
  const box = document.getElementById('adminLoginBox');
  box.style.display = box.style.display === 'none' ? 'block' : 'none';
}

function listenerLogin() {
  const pass = document.getElementById('listenerPassword').value.trim();
  const msg = document.getElementById('listenerMsg');
  if (pass === listenerCode) {
    document.getElementById('login').style.display = 'none';
    document.getElementById('content').style.display = 'block';
    setStreamSrc();
    tryAutoplay();
    msg.textContent = '';
  } else {
    msg.textContent = '‚ùå Nespr√°vn√Ω k√≥d';
  }
}

function adminLogin() {
  const pass = document.getElementById('adminPassword').value.trim();
  const msg = document.getElementById('adminMsg');
  if (pass === ADMIN_PASS) {
    msg.textContent = '‚úÖ P≈ôihl√°≈°eno';
    document.getElementById('adminLoginBox').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('content').style.display = 'block';
    setStreamSrc();
    tryAutoplay();
  } else {
    msg.textContent = '‚ùå ≈†patn√© heslo';
  }
}

function logoutAdmin() {
  document.getElementById('adminPanel').style.display = 'none';
  document.getElementById('adminMsg').textContent = '‚ùå Admin odhl√°≈°en';
  document.getElementById('adminLoginBox').style.display = 'block';
  document.getElementById('adminPassword').value = '';
}

function changeCode() {
  const newCode = document.getElementById('newCode').value.trim();
  const codeMsg = document.getElementById('codeMsg');
  if (newCode.length < 4) {
    codeMsg.textContent = '‚ùå K√≥d mus√≠ m√≠t alespo≈à 4 znaky';
    return;
  }
  listenerCode = newCode;
  localStorage.setItem('listenerCode', newCode);
  document.getElementById('currentCode').textContent = newCode;
  codeMsg.textContent = '‚úÖ K√≥d zmƒõnƒõn';
}

function updateInfo() {
  const message = document.getElementById('adminMessage').value.trim();
  const infoMsg = document.getElementById('infoMsg');
  if (message.length === 0) {
    infoMsg.textContent = '‚ùå Zpr√°va nesm√≠ b√Ωt pr√°zdn√°';
    return;
  }
  localStorage.setItem('infoText', message);
  document.getElementById('infoPanel').innerHTML = '<p>' + message + '</p>';
  infoMsg.textContent = '‚úÖ Info aktualizov√°no';
}

function deleteInfo() {
  localStorage.removeItem('infoText');
  document.getElementById('infoPanel').innerHTML = '<p></p>';
  document.getElementById('infoMsg').textContent = '‚úÖ Zpr√°va smaz√°na';
}

window.addEventListener('load', () => {
  if (document.getElementById('content').style.display !== 'none') tryAutoplay();
});
</script>
</body>
</html>
