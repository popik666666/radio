<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Popik RÃ¡dio</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: white; text-align:center; }
  input, button { padding:10px; margin:5px; border-radius:8px; border:none; font-size:16px; }
  button { background-color:#ff3333; color:white; cursor:pointer; }
  button:hover { background-color:#ff5555; }
  #player, #adminLogin, #adminPanel, #infoPanel { display:none; margin-top:20px; }
  #chat { max-height:200px; overflow-y:auto; background:#222; padding:10px; border-radius:8px; margin-top:10px; text-align:left; }
  .user-msg { display:flex; justify-content:space-between; align-items:center; }
  .kick-btn { background:#555; color:white; font-size:12px; margin-left:5px; padding:2px 5px; border-radius:4px; cursor:pointer; }
</style>
</head>
<body>

<h1>ğŸ§ Popik RÃ¡dio</h1>

<!-- Login posluchaÄe -->
<div id="loginSection">
  <p>Zadej pÅ™Ã­stupovÃ½ kÃ³d:</p>
  <input type="password" id="codeInput" placeholder="Zadej kÃ³d">
  <button onclick="checkCode()">OvÄ›Å™it</button>
</div>

<!-- PÅ™ehrÃ¡vaÄ -->
<div id="player">
  <h2>RÃ¡dio bÄ›Å¾Ã­!</h2>
  <audio id="audioPlayer" controls autoplay></audio>
  <br>
  <button onclick="showAdminLogin()">ğŸ”§ Admin panel</button>

  <!-- InformaÄnÃ­ kanÃ¡l + chat -->
  <div id="infoPanel">
    <h3>InformaÄnÃ­ kanÃ¡l</h3>
    <div id="chat"></div>
    <input type="text" id="chatInput" placeholder="NapiÅ¡ zprÃ¡vu">
    <button onclick="sendChat()">Odeslat</button>
  </div>
</div>

<!-- Login admin -->
<div id="adminLogin">
  <p>Zadej admin heslo:</p>
  <input type="password" id="adminPassword" placeholder="Admin heslo">
  <button onclick="checkAdmin()">PÅ™ihlÃ¡sit</button>
</div>

<!-- Admin panel -->
<div id="adminPanel">
  <h2>âš™ï¸ Admin Panel</h2>
  <p>Zadej zprÃ¡vu pro posluchaÄe:</p>
  <input type="text" id="newMessage" placeholder="NapiÅ¡ zprÃ¡vu">
  <button onclick="sendMessage()">Odeslat</button>
  <br><br>
  <p>ZmÄ›Åˆ pÅ™Ã­stupovÃ½ kÃ³d:</p>
  <input type="text" id="newCode" placeholder="NovÃ½ pÅ™Ã­stupovÃ½ kÃ³d">
  <p>ZmÄ›Åˆ URL streamu:</p>
  <input type="text" id="newStream" placeholder="NovÃ¡ URL streamu">
  <br>
  <button onclick="saveSettings()">ğŸ’¾ UloÅ¾it</button>
  <button onclick="logoutAdmin()">ğŸšª OdhlÃ¡sit se</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

<script>
// Firebase konfigurace
const firebaseConfig = {
  apiKey: "AIzaSyBUtnmX7HyiDVbGx9wjfScQQJtwTmrP07k",
  authDomain: "chat-48ab6.firebaseapp.com",
  databaseURL: "https://chat-48ab6-default-rtdb.firebaseio.com",
  projectId: "chat-48ab6",
  storageBucket: "chat-48ab6.appspot.com",
  messagingSenderId: "963919446639",
  appId: "1:963919446639:web:246e32fb368aab18ac839a",
  measurementId: "G-C7ZBTEZ1TW"
};
const app = firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// VÃ½chozÃ­ hodnoty
let defaultAccessCode = "321456";
let adminPassword = "p666pr";
let defaultStream = "https://popik-666.ismyradio.com";

// LocalStorage
let accessCode = localStorage.getItem("accessCode") || defaultAccessCode;
let streamURL = localStorage.getItem("streamURL") || defaultStream;

// UnikÃ¡tnÃ­ ID uÅ¾ivatele
let userID = sessionStorage.getItem("userID") || "user_" + Date.now();
sessionStorage.setItem("userID", userID);

// BlokovanÃ­ uÅ¾ivatelÃ©
let blockedRef = database.ref('blockedUsers');

// Funkce pro naÄtenÃ­ streamu
function loadStream() {
  const audio = document.getElementById("audioPlayer");
  audio.src = streamURL;
  audio.load();
}

// Login posluchaÄe
function checkCode() {
  const input = document.getElementById('codeInput').value;
  if(input === accessCode){
    document.getElementById('loginSection').style.display='none';
    document.getElementById('player').style.display='block';
    document.getElementById('infoPanel').style.display='block';
    loadStream();
    loadMessages();
    loadChat();
  } else { alert('âŒ NesprÃ¡vnÃ½ kÃ³d!'); }
}

// Admin login
function showAdminLogin() { document.getElementById('adminLogin').style.display='block'; }
function checkAdmin(){
  const input = document.getElementById('adminPassword').value;
  if(input === adminPassword){
    document.getElementById('adminLogin').style.display='none';
    document.getElementById('adminPanel').style.display='block';
    document.getElementById('newCode').value = accessCode;
    document.getElementById('newStream').value = streamURL;
  } else { alert('âŒ NesprÃ¡vnÃ© heslo!'); }
}

// UloÅ¾it nastavenÃ­
function saveSettings(){
  const newCode = document.getElementById('newCode').value.trim();
  const newStream = document.getElementById('newStream').value.trim();
  if(newCode){ accessCode=newCode; localStorage.setItem("accessCode", newCode);}
  if(newStream){ streamURL=newStream; localStorage.setItem("streamURL", newStream); loadStream();}
  alert('âœ… NastavenÃ­ uloÅ¾eno.');
}

// Logout admin
function logoutAdmin(){
  document.getElementById('adminPanel').style.display='none';
  document.getElementById('player').style.display='block';
}

// Admin zprÃ¡vy
function sendMessage(){
  const msg = document.getElementById('newMessage').value.trim();
  if(msg === '') return;
  database.ref('adminMessages').push({ text: msg, time: Date.now() });
  document.getElementById('newMessage').value='';
}

// NaÄtenÃ­ admin zprÃ¡v
function loadMessages(){
  const chatDiv = document.getElementById('chat');
  const messagesRef = database.ref('adminMessages');
  messagesRef.off();
  messagesRef.on('child_added', snapshot=>{
    const data = snapshot.val();
    const msgElem = document.createElement('div');
    const time = new Date(data.time).toLocaleTimeString();
    msgElem.textContent = `[Admin ${time}] ${data.text}`;
    chatDiv.appendChild(msgElem);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });
}

// PosluchaÄskÃ½ chat
function sendChat(){
  const input = document.getElementById('chatInput').value.trim();
  if(input==='') return;

  blockedRef.child(userID).get().then(snap=>{
    if(snap.exists() && snap.val() === true){
      alert('âŒ Jste zablokovÃ¡n a nemÅ¯Å¾ete psÃ¡t do chatu!');
    } else {
      database.ref('chat').push({ text: input, user: userID, time: Date.now() });
      document.getElementById('chatInput').value='';
    }
  });
}

// NaÄtenÃ­ chatu
function loadChat(){
  const chatDiv = document.getElementById('chat');
  const chatRef = database.ref('chat');
  chatRef.off();
  chatRef.on('child_added', snapshot=>{
    const data = snapshot.val();
    const msgElem = document.createElement('div');
    const time = new Date(data.time).toLocaleTimeString();

    if(adminPassword === prompt("Admin heslo (ponej admin panel otevÅ™enÃ½) nebo prÃ¡zdnÃ© pro posluchaÄe") ){
      // Admin vidÃ­ moÅ¾nost kick
      msgElem.innerHTML = `<div class="user-msg">${data.user}: ${data.text} <button class="kick-btn" onclick="kickUser('${data.user}')">âŒ Vyhodit</button></div>`;
    } else {
      msg
